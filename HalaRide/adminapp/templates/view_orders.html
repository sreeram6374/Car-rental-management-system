{% extends 'adminlogin.html' %}

{% block body %}

<div class="px-5 py-5">
  <h4 class="mt-5 fw-bold py-3">Booking Details</h4>

  <table class="table table-bordered table-hover align-middle text-center mb-0">
    <thead class="text-white table-dark">
      <tr>
        <th>Customer Name</th>
        <th>Email</th>
        <th>Mobile</th>
        <th>License No</th>
        <th>License Image</th>
        <th>Address</th>
        <th>Car</th>
        <th>Car Image</th>
        <th>Booking Date</th>
        <th>Pickup</th>
        <th>Drop</th>
        <th>Total Hours</th>
        <th>Price/Hour</th>
        <th>Security Deposit</th>
        <th>Total Price</th>
        <th>Status</th>
        <th>Update Status</th>
      </tr>
    </thead>

    <tbody>
      {% for booking in bookings %}
      <tr>
        <td>{{ booking.customername }}</td>
        <td>{{ booking.email }}</td>
        <td>{{ booking.mobilenumber }}</td>
        <td>{{ booking.licencenumber }}</td>

        <td>
          {% if booking.licenceimage %}
          <img src="{{ booking.licenceimage.url }}" alt="License" style="width: 100px; height: 60px;">
          {% else %}
          No Image
          {% endif %}
        </td>
        <td>{{booking.address}}</td>

        
{% if booking.CarDetails %}

        <td>{{ booking.CarDetails.carname }}</td>

        <td>
          {% if booking.CarDetails.image1 %}
          <img src="{{ booking.CarDetails.image1.url }}" alt="Car" style="width: 100px; height: 60px;">
          {% else %}
          No Image
          {% endif %}
        </td>
        {% else %}
        <td>{{ booking.carname }}</td>

        <td>
          {% if booking.car_image1 %}
          <img src="{{ booking.image1.url }}" alt="Car" style="width: 100px; height: 60px;">
          {% else %}
          No Image
          {% endif %}

    {%endif%}

        <td>{{ booking.bookingdate }}</td>
        <td>{{ booking.pickup_datetime|date:"d-m-Y H:i" }}</td>
        <td>{{ booking.drop_datetime|date:"d-m-Y H:i" }}</td>
        <td>{{ booking.total_hours }} hrs</td>
       {% if booking.CarDetails %} 
        <td>₹{{ booking.CarDetails.price }}</td>
        <td>₹{{ booking.CarDetails.deposit }}</td>
        {% else %}
        <td>₹{{ booking.price }}</td>
        <td>₹{{ booking.deposit }}</td>
        {%endif%}
        <td>₹{{ booking.total_price }}</td>
        <td>{{booking.status}}</td>
        

  <form method="POST" action="{% url 'update_status' booking.id %}">
  {% csrf_token %}
  <td>
    <select name="status" class="form-select" onchange="this.form.submit()">
      <option value="Pending" {% if booking.status == "Pending" %}selected{% endif %}>Pending</option>
      <option value="Confirmed" {% if booking.status == "Confirmed" %}selected{% endif %}>Confirmed</option>
      <option value="Cancelled" {% if booking.status == "Cancelled" %}selected{% endif %}>Cancelled</option>
      <option value="Completed" {% if booking.status == "Completed" %}selected{% endif %}>Completed</option>
    </select>
  </td>
</form>
        
      </tr>
      {% empty %}
      <tr>
        <td colspan="15">No bookings found.</td>
      </tr>
     
      {% endfor %}
    </tbody>
  </table>

 <hr>
   <!-- Cancelled Bookings -->
              <div class="table-responsive mt-5">
                <div class="h4 fw-bold pb-3">Cancelled Bookings</div>
        <table class="table table-bordered text-center align-middle">
          <thead class="table-dark">
            <tr>
              <th>Customer Name</th>
              <th>Email</th>
              <th>Mobile</th>
              <th>License No</th>
              <th>License Image</th>
              <th>Car</th>
              <th>Car Image</th>
              <th>Booking Date</th>
              <th>Pickup</th>
              <th>Drop</th>
              <th>Total Hours</th>
              <th>Price/Hour</th>
              <th>Security Deposit</th>
              <th>Total Price</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody>
            {% for booking in cancelled_booking %}
            <tr style="background-color: #ccc; color: #777;">
              <td>{{ booking.customername }}</td>
              <td>{{ booking.email }}</td>
              <td>{{ booking.mobilenumber }}</td>
              <td>{{ booking.licencenumber }}</td>
              <td>
                
                <img src="{{ booking.licenceimage.url }}" alt="License" style="width: 100px; height: 60px" />
              </td>
              <td>{{ booking.carname }}</td>
           <td>
  {% if booking.car_image1 %}
    <img src="{{ booking.car_image1.url }}" alt="Car" style="width: 100px; height: 60px" />
  {% else %}
    <span>No Image</span>
  {% endif %}
</td>
              <td>{{ booking.bookingdate }}</td>
              <td>{{ booking.pickup_datetime|date:"d-m-Y H:i" }}</td>
              <td>{{ booking.drop_datetime|date:"d-m-Y H:i" }}</td>
              <td>{{ booking.total_hours }} hrs</td>
              <td>₹{{ booking.price }}</td>
              <td>₹{{ booking.deposit }}</td>
              <td>₹{{ booking.total_price }}</td>
              <td>
                <span class="badge bg-danger">Cancelled</span>
              </td>
              <td>
                <div class="btn btn-secondary disabled">Cancelled</div>
              </td>
              
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
</div>

{% endblock %}
